getwd
getwd()
setwd("Documents/stage")
getwd()
ls
ls()
dir()
setwd("mangal.package")
load.all()
load()
source('~/Documents/stage/importation_mangal/roberson_1929/1-meta_clean_roberson_1929.R', echo=TRUE)
source('~/Documents/stage/importation_mangal/roberson_1929/1-meta_clean_roberson_1929.R', echo=TRUE)
source('~/Documents/stage/importation_mangal/roberson_1929/1-meta_clean_roberson_1929.R', echo=TRUE)
library(taxize)
library(stringr)
devtools::load_all()
#' @title POST a line of json data into a Mangal table
#'
#' @description POST a line of json data into the Mangal table specified by the user
#'
#' @param table_lst_line A json line of data
#' @param table A element, must be the name of the targeted table with ""
#'
#' @return
#'
#' The status of the request
#'
#' @author Gabriel Bergeron
#'
#' @keywords database
#'
#' @importFrom httr modify_url
#' @importFrom httr POST
#' @importFrom httr add_headers
#' @importFrom jsonlite unbox
#'
#' @export
# Table must be inside " "
POST_line <- function (table_lst_line, table) {
# Data.line must be of class JSON
if(class(table_lst_line) != "json") stop(" 'table_lst_line' must be a json")
# Connect to API
server <- mangal.env$prod$server
# Set the "table" as path
path <- httr::modify_url(server, path = paste0(mangal.env$base, "/",table))
# Post a line of data
if ((any(grepl("\\[\\{", table_lst_line))) == TRUE) {
httr::POST(path, body = substr(table_lst_line, 2, (nchar(table_lst_line))-1), config = mangal.env$headers))
} else {
httr::POST(path, body = table_lst_line, config = add_headers("Content-type" = "application/json"))
}
}
#' @title POST a line of json data into a Mangal table
#'
#' @description POST a line of json data into the Mangal table specified by the user
#'
#' @param table_lst_line A json line of data
#' @param table A element, must be the name of the targeted table with ""
#'
#' @return
#'
#' The status of the request
#'
#' @author Gabriel Bergeron
#'
#' @keywords database
#'
#' @importFrom httr modify_url
#' @importFrom httr POST
#' @importFrom httr add_headers
#' @importFrom jsonlite unbox
#'
#' @export
# Table must be inside " "
POST_line <- function (table_lst_line, table) {
# Data.line must be of class JSON
if(class(table_lst_line) != "json") stop(" 'table_lst_line' must be a json")
# Connect to API
server <- mangal.env$prod$server
# Set the "table" as path
path <- httr::modify_url(server, path = paste0(mangal.env$base, "/",table))
# Post a line of data
if ((any(grepl("\\[\\{", table_lst_line))) == TRUE) {
httr::POST(path, body = substr(table_lst_line, 2, (nchar(table_lst_line))-1), config = mangal.env$headers)
} else {
httr::POST(path, body = table_lst_line, config = mangal.env$headers)
}
}
devtools::load_all()
lat  <- -24.2653
lon  <- -48.4069
srid <- 4326
attr_inter <- list(name  = "Presence/Absence",
table_owner = "interactions",
description = "Presence or absence of a recorded interaction",
unit        = "NA")
refs <- list(doi       = "10.5962/bhl.title.11538",
jstor     = "NA",
pmid      = "NA",
author    = "roberson",
year      = "1929",
paper_url = "https://www.biodiversitylibrary.org/bibliography/11538#/summary",
data_url  = "https://www.nceas.ucsb.edu/interactionweb/html/robertson_1929.html",
bibtex    = "@book{bhl43820, title = {Flowers and insects; lists of visitors of four hundred and fifty-three flowers,  }, copyright = {Public domain.  Published 1923-1963 with notice but no evidence of copyright renewal found in Stanford Copyright Renewal Database.  Contact dcc@library.uiuc.edu for information.}, url = {https://www.biodiversitylibrary.org/item/43820}, publisher = {Carlinville, Ill.,n.p.}, author = {Robertson, Charles,}, year = {}, pages = {234}, keywords = {Bees|Fertilization of plants|Flowers|Illinois|Insects|Macoupin County|}}")
users <- list(name         = "Gabriel Bergeron",
email        = "gabriel.bergeron3@usherbrooke.ca",
orcid        = "null",
organization = "Universite de Sherbrooke",
type         = "administrator")
enviro <- list(name  = "NAME",
lat   = lat,
lon   = lon,
srid  = srid,
date  = "1899-07-01",
value = 0)
datasets <- list(name        = "Roberson_1929",
date        = "1899-07-01",
description = "Insects observed to pollinate flowers, ten miles of Carlinville, Illinois, USA",
public      = TRUE)
traits <- list(date = "1899-07-01")
networks <- list(name             = "Roberson_1929",
date             = "1899-07-01",
lat              = lat,
lon              = lon,
srid             = srid,
description      = "Insects observed to pollinate flowers, ten miles of Carlinville, Illinois, USA",
public           = TRUE,
all_interactions = FALSE)
inter <- list(taxon_1_level = "taxon",
taxon_2_level = "taxon",
date          = "1899-07-01",
direction     = "directed",
type          = "mutualism",
method        = "Field observations",
description   = "Visit of an insect to a flower",
public        = TRUE,
lat           = lat,
lon           = lon,
srid          = srid)
getwd()
setwd("/Users/gabriel/Documents/stage/")
getwd()
setwd("importation_mangal/roberson_1929")
getwd()
taxo_back_df <- read.csv2("data/roberson_1929_taxo_back.csv", header = TRUE)
taxons_df <- read.csv2("data/roberson_1929_taxons.csv", header = TRUE)
roberson_1929 <- read.csv2("data/roberson_1929_inter.csv", header = TRUE)
POST_attributes(attr_inter)
POST_refs()
POST_users()
POST_datasets()
POST_datasets()
POST_datasets
getwd()
setwd("~stage/mangal.package")
setwd("~")
getwd()
setwd("~Document/stage/mangal.package")
setwd("~Documents/stage/mangal.package")
setwd("~/Documents")
dir()
setwd("/stage")
setwd("stage/mangal.package")
get()
getwd()
devtools::load_all()
POST_datasets
POST_datasets()
server <- mangal.env$prod$server
path <- httr::modify_url(server, path = paste0(mangal.env$base, "/datasets/?name=",
datasets[[1]]))
path <- gsub(" ", "%20", path)
if (length(content(httr::GET(url = gsub(" ", "%20", paste0(server, mangal.env$base, "/users/?name=", users[["name"]])), config = mangal.env$headers))) != 0){
datasets <- c(datasets, user_id = GET_fkey("users","name", users[["name"]]))
}
users[["name"]]
table <- "users"
attribute <- "name"
value <- "Gabriel Bergeron"
server <- mangal.env$prod$server
url <- httr::modify_url(server, path = paste0(mangal.env$base, "/", table, "/?"))
url
url <- gsub(" ", "%20", paste0(url, attribute, "=", value))
url
data <- httr::GET(url)
data
GET(http://poisotlab.biol.umontreal.ca/api/v0/users/?name=Gabriel%20Bergeron)
GET("http://poisotlab.biol.umontreal.ca/api/v0/users/?name=Gabriel%20Bergeron")
?GET()
GET("http://poisotlab.biol.umontreal.ca/api/v0/users/?name=Gabriel%20Bergeron", config = mangal.env$headers)
data <- httr::GET(url, config = mangal.env$headers)
data <- httr::content(data)
data
data <- httr::GET(url)
http_error(data)
if(http_error(data) == TRUE) stop(paste("Bad request for", url))
data <- httr::GET(url, config = mangal.env$headers)
if(http_error(data) == TRUE) stop(paste("Bad request for", url))
data <- httr::content(data)
if((length(data) > 1) == TRUE) stop(paste0("more than one entry for ",  url))
getwd()
devtools::load_all()
POST_datasets()
POST_networks(networks, enviro = enviro)
POST_taxo_back()
